<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Game</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-H0RTBY9Q2J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date()); gtag('config', 'G-H0RTBY9Q2J'); 
  </script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
  <script>
    // VConsole 默认会挂载到 `window.VConsole` 上
    var vConsole = new window.VConsole();
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    Telegram.WebApp.BackButton.hide();
  </script>
  <script>
    // 获取 Telegram Web App 初始化数据
    const initDataUnsafe = Telegram.WebApp.initDataUnsafe;

    // 获取用户信息
    const user = initDataUnsafe.user;
    const userId = user.id;
    const botToken = '7423063730:AAG4fZq9qnsEDh0nfxwKralBHtX7obAnWqk';

    // 通过 Bot API 获取用户头像
    async function getUserProfilePhotos(userId) {
      const response = await fetch(`https://api.telegram.org/bot${botToken}/getUserProfilePhotos?user_id=${userId}`);
      const data = await response.json();
      if (data.ok && data.result.photos.length > 0) {
        // 获取第一张照片的文件 ID
        const fileId = data.result.photos[0][0].file_id;
        // 获取文件 URL
        const fileResponse = await fetch(`https://api.telegram.org/bot${botToken}/getFile?file_id=${fileId}`);
        const fileData = await fileResponse.json();
        if (fileData.ok) {
          const fileUrl = `https://api.telegram.org/file/bot${botToken}/${fileData.result.file_path}`;
          // 显示用户头像
          const img = document.createElement('img');
          img.src = fileUrl;
          console.log(fileUrl);
          document.body.appendChild(img);
        }
      }
    }

    // 调用函数获取用户头像
    getUserProfilePhotos(userId);
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>